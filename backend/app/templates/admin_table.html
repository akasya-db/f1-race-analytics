<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ table_info.name }} - Admin Panel | F1 Race Analytics</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
</head>
<body>
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="flash-messages">
        {% for message in messages %}
          <div class="flash-message {% if 'error' in message|lower or 'failed' in message|lower %}error{% endif %}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <header class="nav" aria-label="Primary">
    <a href="{{ url_for('auth.index') }}" class="brand" aria-label="F1 Race Analytics">
      <div class="logo" aria-hidden="true"></div>
      <span>F1 Race Analytics</span>
    </a>
    <nav class="menu" aria-label="Main menu">
      <a href="{{ url_for('admin.admin_panel') }}">Admin Panel</a>
      <a href="{{ url_for('auth.profile') }}">Profile</a>
      <a href="{{ url_for('auth.logout') }}">Logout</a>
    </nav>
  </header>

  <div class="admin-container">
    <div class="admin-header">
      <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
        <div>
          <h1>{{ table_info.name }}</h1>
          <p>{{ total_count }} record{{ 's' if total_count != 1 else '' }} found</p>
        </div>
        <a href="{{ url_for('admin.admin_table_create', table_name=table_name) }}" class="btn btn-primary">
          + Add New {{ table_info.display_name }}
        </a>
      </div>
    </div>

    {% if records %}
    <div class="table-wrapper">
      <table class="admin-table">
        <thead>
          <tr>
            {% for col in schema[:10] %}
            <th>{{ col.name|replace('_', ' ')|title }}</th>
            {% endfor %}
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for record in records %}
          <tr>
            {% for col in schema[:10] %}
            <td>
              {% if record[col.name] is none %}
                <span style="color: var(--f1-grey); opacity: 0.5;">NULL</span>
              {% elif col.type == 'boolean' %}
                {{ 'Yes' if record[col.name] else 'No' }}
              {% elif col.type in ['timestamp without time zone', 'timestamp with time zone'] %}
                {{ record[col.name].strftime('%Y-%m-%d %H:%M') if record[col.name] else '' }}
              {% else %}
                {{ record[col.name]|string|truncate(50) }}
              {% endif %}
            </td>
            {% endfor %}
            <td class="actions-cell">
              <a href="{{ url_for('admin.admin_table_edit', table_name=table_name, record_id=record[table_info.id_column]) }}" class="btn-icon btn-edit" title="Edit">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </a>
              <form method="POST" action="{{ url_for('admin.admin_table_delete', table_name=table_name, record_id=record[table_info.id_column]) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this record? This action cannot be undone.');">
                <button type="submit" class="btn-icon btn-delete" title="Delete">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  </svg>
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if total_pages > 1 %}
    <div class="pagination">
      {% if page > 1 %}
      <a href="{{ url_for('admin.admin_table_list', table_name=table_name, page=page-1) }}" class="btn btn-secondary">Previous</a>
      {% endif %}
      
      <span style="color: var(--f1-grey);">Page {{ page }} of {{ total_pages }}</span>
      
      {% if page < total_pages %}
      <a href="{{ url_for('admin.admin_table_list', table_name=table_name, page=page+1) }}" class="btn btn-secondary">Next</a>
      {% endif %}
    </div>
    {% endif %}

    {% else %}
    <div class="empty-state">
      <p>No records found in this table.</p>
      <a href="{{ url_for('admin.admin_table_create', table_name=table_name) }}" class="btn btn-primary">Create First Record</a>
    </div>
    {% endif %}
  </div>

  <script>
    // Auto-remove flash messages after 4 seconds
    document.addEventListener('DOMContentLoaded', function() {
      const flashMessages = document.querySelectorAll('.flash-message');
      flashMessages.forEach(function(message) {
        setTimeout(function() {
          message.remove();
        }, 4000);
      });
    });
  </script>
</body>
</html>

