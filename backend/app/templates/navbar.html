{% set is_authenticated = authenticated if authenticated is defined else (session.get('username') is not none) %}
{% set display_username = username if username is defined and username else current_username if current_username is defined and current_username else session.get('username') %}
{% set user_is_admin = is_admin if is_admin is defined else session.get('is_admin', False) %}

<header class="nav" aria-label="Primary">
  <a href="{{ url_for('auth.index') }}" class="brand" aria-label="F1 Race Analytics">
    <div class="logo" aria-hidden="true"></div>
    <span>F1 Race Analytics</span>
  </a>
  <nav class="menu" aria-label="Main menu">
    {% if is_authenticated %}
      <div class="user-dropdown">
        <div class="user-dropdown-toggle" onclick="toggleDropdown()">
          <span>{{ display_username }}</span>
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="dropdown-menu">
          <a href="{{ url_for('auth.profile') }}">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Profile</span>
          </a>
          {% if user_is_admin %}
          <a href="{{ url_for('admin.admin_panel') }}">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="4" width="18" height="16" rx="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M8 4v16M16 4v16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Admin Panel</span>
          </a>
          {% endif %}
          <a href="{{ url_for('auth.logout') }}">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Logout</span>
          </a>
        </div>
      </div>
    {% else %}
      <a href="{{ url_for('auth.login') }}">Login</a>
      <a href="{{ url_for('auth.register') }}">Register</a>
    {% endif %}
  </nav>
</header>
